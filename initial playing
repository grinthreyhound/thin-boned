
// things to achieve, then try to do them:

//go through all the variables: best to develop this on smaller dataset:
cd "H:\JOE\THIN"
use in 1/40 using consults3m.dta



//how many lines in the dataset?
count

//id: how many id's? 

// create a list number:
generate order = _n 

//create a label y for each nth event that each child has
by id (order), sort: generate y = _n  

//we are going to drop data so preserve the set
preserve  
keep id y eventdate 
//go from long to wide
quietly reshape wide eventdate , i(id) j(y)  
count
restore

//Case: how many entries are cases vs controls?  
inspect case
bysort case: count
tab case

//how many patients are cases vs controls?
preserve  
keep id y eventdate case
//go from long to wide
quietly reshape wide eventdate , i(id) j(y)  
tab case
bysort case:count
restore

//indexdate: what is the range of dates?
egen datemax = max(indexdate)
egen datemin = min(indexdate)

//Eventdate: what is the range of dates?
egen eventdatemax = max(eventdate)
egen eventdatemin = min(eventdate)

//consultgroups 1-4, how many of each?
tab consult_group1
tab consult_group2
tab consult_group3
tab consult_group4

//medcode 1-8: how many of each? : not a sensible question as they are strings and there are lots of them.

//symptom 1-8: as above, many different ones

//Age at index date: what is the age range of: events, cases, controls (truthing, should be the same).  Graph these (histogram).
sum age
hist age
graph export ageatdiagnosis.tif, replace
hist age, by(case)
graph export agecase.tif, replace


//sex: what is the sex distribution of: events, cases and controls: should be same
tab sex
tab sex case

preserve  
keep id y eventdate case sex
//go from long to wide
quietly reshape wide eventdate , i(id) j(y)  
tab sex
tab sex case
hist sex, discrete by(case, col(1))
graph export sexcase.tif, replace
restore

//died: how many? when? should be none
tab died

//birthdate: range?
sum birthdate

//regdate: range?  Should be 15 months before indexdate: check this.  
sum regdate
generate reg = indexdate - regdate
sum reg
drop reg

// xferdate: how many?  when?
sum xferdate
generate xfer = indexdate - xferdate
sum xfer

//deathdate: see death

//case_patid: matching ID

//typediab: make sure all cases have this and no controls do.  Actually some cases don't have a type. 
preserve
keep id y eventdate case typediab
quietly reshape wide eventdate , i(id) j(y)  
tab typediab
tab typediab case
restore

