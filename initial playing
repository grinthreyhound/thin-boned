//thin analysis - start with familiarising with stata again.
//set directory and load the data
cd "H:\JOE\THIN"
use consults3m.dta

//take a look at it:
// variables
describe
//more compactly can do ds to get names of variables only

summarize indexdate //or su indexdate, and can ask for detail: su indexdate, d, which gives
//centiles etc, not that this is meaningful for index date

su age, d

tab consult_group1

//list gives us each case with it's characteristics: 
//immediately there is an error in that one of the cases has code 0 for 
//typediab

list case typediab in 1/5

// can try to find others: 

list id case typediab if typediab==0 & case==1


//There are loads of them!

//try to create a variable for them:

generate mismatch1 = 1 if typediab==0 & case==1 

tab mismatch //there are 847 of them

// this is because each line is an event, not a patient - so they were seen before diagnosis of DM

// graphing index dates seems to show data ranges from 01Jan2000 to approx jan 2011

// things to achieve, then try to do them:

//go through all the variables:] best to develop this on smaller dataset:
cd "H:\JOE\THIN"
use in 1/40 using consults3m.dta

//how many lines in the dataset?
count

//id: how many id's? 

// create a list number:
generate order = _n 

//create a label y for each nth event that each child has
by id (order), sort: generate y = _n  

//we are going to drop data so preserve the set
preserve  
keep id y eventdate 
//go from long to wide
quietly reshape wide eventdate , i(id) j(y)  
count
restore

//Case: how many entries are cases vs controls?  how many patients are cases vs controls?
inspect case
bysort case: count

preserve  
keep id y eventdate case
//go from long to wide
quietly reshape wide eventdate , i(id) j(y)  
tab case
restore

//indexdate: what is the range of dates?


//Eventdate: what is the range of dates?

//consultgroups 1-4, how many of each?

//medcode 1-8: how many of each?

//symptom 1-8: as above, are they the same (truthing)

//Age at index date: what is the age range of: events, cases, controls (truthing, should be the same).  Graph these (histogram).

//sex: what is the sex distribution of: events, cases and controls: should be same

//died: how many? when? should be none

//birthdate: range?

//regdate: range?  Should be 15 months before indexdate: check this.  

// xferdate: how many?  when?

//deathdate: see death

//case_patid: matching ID

//typediab: make sure all cases have this and no controls do.

//
